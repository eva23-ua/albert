<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Alberto y Elena</title>

  <style>
    :root{
      --bg: #f6f9ff;
      --bg2:#eef5ff;
      --card:#ffffffcc;
      --stroke:#e6eefc;
      --text:#1f2a44;
      --muted:#6b7a99;

      --blue:#7bb6ff;
      --blue2:#9fd3ff;
      --lav:#cbb7ff;
      --pink:#ffc2e2;

      --radius:18px;
      --shadow: 0 14px 30px rgba(24, 56, 120, .10);
      --shadow2: 0 10px 18px rgba(24, 56, 120, .08);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color: var(--text);
      background:
        radial-gradient(900px 450px at 20% 0%, rgba(123,182,255,.25), transparent 60%),
        radial-gradient(900px 450px at 80% 15%, rgba(203,183,255,.22), transparent 60%),
        radial-gradient(900px 450px at 60% 110%, rgba(255,194,226,.18), transparent 60%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      min-height:100vh;
    }

    /* contenedor tipo app */
    .app{
      max-width: 520px;
      margin: 0 auto;
      padding-bottom: 22px;
    }

    /* FOTO ARRIBA A TODO ANCHO */
    .hero{
      position: relative;
      width: 100%;
      height: 210px;
      overflow: hidden;
      border-bottom-left-radius: 26px;
      border-bottom-right-radius: 26px;
      box-shadow: var(--shadow);
      background: linear-gradient(135deg, rgba(123,182,255,.35), rgba(203,183,255,.25));
    }
    .hero img{
      position: relative;
      z-index:1;
      width:100%;
      height:100%;
      object-fit: contain;   /* üëà para que verticales se vean completas */
      display:block;
      background: transparent;
      filter: saturate(1.05) contrast(1.02);
    }

    /* capa suave encima para que el texto se lea */
    .hero::after{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.18));
      pointer-events:none;
    }

    .heroText{
      position:absolute;
      left: 16px;
      right: 16px;
      bottom: 14px;
      z-index:2;
      color: #fff;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
    }
    .heroText h1{
      margin:0;
      font-size: 22px;
      letter-spacing: .2px;
      line-height:1.1;
      text-shadow: 0 8px 22px rgba(0,0,0,.25);
    }
    .heroText p{
      margin: 6px 0 0;
      font-size: 12.5px;
      opacity:.92;
      text-shadow: 0 8px 22px rgba(0,0,0,.25);
    }

    .heroBg{
      position:absolute;
      inset:0;
      background-size: cover;
      background-position: center;
      filter: blur(16px) brightness(0.9);
      transform: scale(1.1);
      z-index:0;
    }
    .heroBg.loading{
      background-image: linear-gradient(135deg, rgba(123,182,255,.35), rgba(203,183,255,.25));
    }

    .hero img{
      transition: opacity .25s ease;
    }
    .hero img.loading{
      opacity: 0;
    }


    /* Flechas */
    .nav{
      position:absolute;
      top:50%;
      transform: translateY(-50%);
      z-index:3;
      width: 40px;
      height: 40px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.35);
      background: rgba(255,255,255,.18);
      backdrop-filter: blur(8px);
      color: #fff;
      font-size: 28px;
      line-height: 40px;
      text-align:center;
      cursor:pointer;
      box-shadow: 0 10px 18px rgba(0,0,0,.12);
    }
    .nav:active{ transform: translateY(-50%) scale(.97); }
    .nav.prev{ left: 10px; }
    .nav.next{ right: 10px; }

    /* Puntos */
    .dots{
      position:absolute;
      left:0;
      right:0;
      bottom: 10px;
      z-index:3;
      display:flex;
      justify-content:center;
      gap: 7px;
      pointer-events:none;
    }
    .dot{
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: rgba(255,255,255,.45);
      border: 1px solid rgba(255,255,255,.35);
    }
    .dot.active{
      background: rgba(255,255,255,.95);
    }


    .chip{
      background: rgba(255,255,255,.20);
      border: 1px solid rgba(255,255,255,.25);
      backdrop-filter: blur(8px);
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 12px;
      white-space: nowrap;
      box-shadow: 0 10px 20px rgba(0,0,0,.10);
    }

    .content{
      padding: 14px 14px 0;
    }

    .card{
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      padding: 14px;
      backdrop-filter: blur(10px);
    }

    .muted{ color: var(--muted); font-size: 13px; line-height: 1.35; margin:0; }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 12px;
    }

    .bigBtn{
      border: 1px solid var(--stroke);
      border-radius: 18px;
      padding: 14px 12px;
      text-align:left;
      background: #fff;
      cursor:pointer;
      box-shadow: 0 10px 18px rgba(24,56,120,.06);
      transition: transform .08s ease;
    }
    .bigBtn:active{ transform: scale(.98); }
    .bigBtn .t{ font-weight: 800; font-size: 15px; display:flex; align-items:center; gap:8px; }
    .bigBtn .s{ margin-top: 6px; font-size: 12.5px; color: var(--muted); }
    .bigBtn.pelis{
      background: linear-gradient(180deg, rgba(159,211,255,.35), rgba(255,255,255,1));
    }
    .bigBtn.planes{
      background: linear-gradient(180deg, rgba(203,183,255,.28), rgba(255,255,255,1));
    }

    .topRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 10px;
    }

    .back{
      border: 1px solid var(--stroke);
      background:#fff;
      border-radius: 12px;
      padding: 10px 12px;
      cursor:pointer;
      font-weight:700;
      color: var(--text);
    }
    .title{
      font-size: 16px;
      font-weight: 900;
      margin:0;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .pill{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.9);
      color: var(--muted);
      border-radius: 999px;
      padding: 7px 10px;
      font-size: 12px;
      white-space:nowrap;
    }

    .row{
      display:flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .input{
      flex: 1 1 180px;
      border: 1px solid var(--stroke);
      background: #fff;
      border-radius: 14px;
      padding: 12px 12px;
      outline:none;
      font-size: 14px;
    }
    .input::placeholder{ color: #9aa8c4; }

    .btn{
      border:0;
      border-radius: 14px;
      padding: 12px 12px;
      cursor:pointer;
      font-weight: 900;
      font-size: 14px;
      transition: transform .08s ease;
      white-space:nowrap;
    }
    .btn:active{ transform: scale(.98); }

    .btnAdd{
      background: linear-gradient(90deg, var(--blue), var(--blue2));
      color: #0f2a44;
      box-shadow: 0 10px 18px rgba(123,182,255,.25);
    }
    .btnRandom{
      background: linear-gradient(90deg, var(--lav), var(--pink));
      color: #2a2144;
      box-shadow: 0 10px 18px rgba(203,183,255,.20);
    }
    .btnGhost{
      background:#fff;
      border:1px solid var(--stroke);
      color: var(--text);
      font-weight: 800;
    }

    .pickCard{
      margin-top: 12px;
      border-radius: 18px;
      padding: 14px;
      background: linear-gradient(180deg, rgba(159,211,255,.35), rgba(255,255,255,1));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow2);
    }
    .pickLabel{
      font-size: 12px;
      color: var(--muted);
      margin:0 0 6px;
    }
    .picked{
      font-size: 18px;
      font-weight: 900;
      margin: 0 0 10px;
      line-height: 1.25;
    }

    .list{
      list-style:none;
      padding:0;
      margin: 10px 0 0;
      display:flex;
      flex-direction:column;
      gap: 10px;
    }
    .item{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid var(--stroke);
      background:#fff;
    }
    .item span{
      font-size: 14px;
      line-height:1.25;
      word-break: break-word;
    }
    .del{
      border:1px solid var(--stroke);
      background: #fff;
      border-radius: 12px;
      padding: 10px 10px;
      cursor:pointer;
      font-weight: 900;
      color:#6a77a0;
    }

    .hidden{ display:none; }

    @media (max-width: 380px){
      .hero{ height: 190px; }
      .btn{ flex: 1; }
      .row{ gap: 8px; }
      .grid2{ gap: 8px; }
    }
  </style>
</head>

<body>
  <div class="app">
    <!-- FOTO SUPERIOR -->
    <div class="hero">
      <div class="heroBg" id="heroBg"></div>

      <img id="heroImg" src="1.jpeg" alt="Alberto y Elena">

      <button class="nav prev" type="button" onclick="prevPhoto()">‚Äπ</button>
      <button class="nav next" type="button" onclick="nextPhoto()">‚Ä∫</button>

      <div class="dots" id="dots"></div>

      <div class="heroText">
        <div>
          <h1>Alberto & Elena</h1>
        </div>
        <div class="chip">üíô</div>
      </div>
    </div>

    <div class="content">
      <!-- HOME -->
      <div class="card" id="home">
        <p class="muted">A√±adimos ideas cuando se nos ocurran, y cuando no sepamos qu√© hacer‚Ä¶ que elija el azar.</p>

        <div class="grid2">
          <button class="bigBtn pelis" onclick="openType('pelis')">
            <div class="t">üé¨ Pelis</div>
          </button>

          <button class="bigBtn planes" onclick="openType('planes')">
            <div class="t">üóìÔ∏è Planes</div>
            <div class="s">A√±adir ‚Ä¢ sortear ‚Ä¢ hacer ‚Ä¢ borrar</div>
          </button>
        </div>
      </div>

      <!-- APP -->
      <div class="card hidden" id="appCard" style="margin-top:14px;">
        <div class="topRow">
          <button class="back" onclick="goHome()">‚¨ÖÔ∏è</button>
          <h2 class="title" id="sectionTitle"></h2>
          <div class="pill" id="countPill">0</div>
        </div>

        <div class="row">
          <input class="input" id="input" placeholder="A√±adir..." />
          <button class="btn btnAdd" onclick="addItem()">A√±adir</button>
          <button class="btn btnRandom" onclick="pickRandom()">Al azar</button>
        </div>

        <div class="pickCard hidden" id="pickCard">
          <p class="pickLabel">Ha salido esto:</p>
          <p class="picked" id="picked"></p>
          <div class="row">
            <button class="btn btnAdd" onclick="markDone()">Elegir / borrar</button>
            <button class="btn btnGhost" onclick="pickAnother()">Otra</button>
          </div>
        </div>

        <div style="margin-top:12px;">
          <p class="muted" id="empty"></p>
          <ul class="list" id="list"></ul>
        </div>
      </div>
    </div>
  </div>

<script>
  // ‚úÖ PEGA AQU√ç TU URL DE APPS SCRIPT (la que termina en /exec):
  const API_URL = "https://script.google.com/macros/s/AKfycbyqVNMao0qcQyBffN6MIaS5SdVyCBdenNOFt8LrCBMvQUPeblPcCW0DjKsoPQTMDyuGXQ/exec";

  // Si en el script pusiste un PIN, ponlo aqu√≠. Si no, d√©jalo vac√≠o.
  const PIN = "";

  ////////////// FOTOS /////////////////
  // IMPORTANTE: respeta may√∫sculas/min√∫sculas exactas del nombre del archivo.
  // En tu carpeta tienes 4.JPG, 7.JPG... pero en el array pusiste 4.jpg, 7.jpg.
  // En GitHub Pages eso FALLA y por eso a partir de ciertas fotos ‚Äúno carga‚Äù.
  const photos = [
    "1.jpeg",
    "2.jpeg",
    "3.jpg",
    "4.JPG",
    "5.jpg",
    "6.jpg",
    "7.JPG",
    "8.JPG",
    "9.jpg",
    "10.jpg"
  ];

  let photoIndex = 0;
  let heroTimer = null;

  const heroImg = document.getElementById("heroImg");
  const heroBg = document.getElementById("heroBg");
  const dotsEl = document.getElementById("dots");

  function renderDots() {
    if (!dotsEl) return;
    dotsEl.innerHTML = "";
    photos.forEach((_, i) => {
      const d = document.createElement("div");
      d.className = "dot" + (i === photoIndex ? " active" : "");
      dotsEl.appendChild(d);
    });
  }

  // Precarga UNA foto y devuelve una promesa cuando est√° lista
  function preloadImage(src) {
    return new Promise((resolve, reject) => {
      const img = new Image();
      img.onload = () => resolve(src);
      img.onerror = () => reject(new Error("No se pudo cargar: " + src));
      img.src = src;
    });
  }

  async function setPhoto(i) {
    if (!heroImg) return;

    photoIndex = (i + photos.length) % photos.length;
    const src = photos[photoIndex];

    // Estado ‚Äúcargando‚Äù
    heroImg.classList.add("loading");
    if (heroBg) heroBg.classList.add("loading");

    try {
      // Pre-carga antes de mostrar (evita mancha/flash blanco)
      await preloadImage(src);

      // Actualiza fondo + foto
      heroImg.src = src;
      if (heroBg) heroBg.style.backgroundImage = `url('${src}')`;

      // Quita estado ‚Äúcargando‚Äù
      heroImg.classList.remove("loading");
      if (heroBg) heroBg.classList.remove("loading");

      renderDots();

      // Preload del siguiente para que el carrusel vaya fluido
      const nextSrc = photos[(photoIndex + 1) % photos.length];
      preloadImage(nextSrc).catch(() => {});
    } catch (err) {
      console.warn(err);

      // Si falla, pasa a la siguiente en vez de esconder la imagen para siempre
      heroImg.classList.remove("loading");
      if (heroBg) heroBg.classList.remove("loading");

      // salta a la siguiente (evita quedarte en blanco)
      if (photos.length > 1) {
        setPhoto(photoIndex + 1);
      }
    }
  }

  function nextPhoto() {
    setPhoto(photoIndex + 1);
    restartAuto();
  }

  function prevPhoto() {
    setPhoto(photoIndex - 1);
    restartAuto();
  }

  function startAuto() {
    if (photos.length <= 1) return;
    heroTimer = setInterval(() => setPhoto(photoIndex + 1), 5000);
  }

  function restartAuto() {
    if (heroTimer) clearInterval(heroTimer);
    heroTimer = setInterval(() => setPhoto(photoIndex + 1), 6500);
  }

  // init
  if (heroImg) {
    // NO escondas la imagen al error; ahora gestionamos errores en setPhoto()
    setPhoto(0);
    startAuto();
  }
  ///////////////////////////////


  let currentType = null;   // "pelis" o "planes"
  let items = [];           // [{id,type,title,createdAt}]
  let currentPick = null;

  const home = document.getElementById("home");
  const app = document.getElementById("appCard");
  const titleEl = document.getElementById("sectionTitle");
  const inputEl = document.getElementById("input");
  const listEl = document.getElementById("list");
  const emptyEl = document.getElementById("empty");
  const pickCard = document.getElementById("pickCard");
  const pickedEl = document.getElementById("picked");

  function goHome() {
    currentType = null;
    items = [];
    currentPick = null;
    pickCard.classList.add("hidden");
    app.classList.add("hidden");
    home.classList.remove("hidden");
  }

  async function openType(type) {
    currentType = type;
    titleEl.textContent = type === "pelis" ? "üé¨ Pelis" : "üóìÔ∏è Planes";
    home.classList.add("hidden");
    app.classList.remove("hidden");
    pickCard.classList.add("hidden");
    currentPick = null;
    await refresh();
    inputEl.value = "";
    inputEl.focus();
  }

  async function refresh() {
    const url = new URL(API_URL);
    url.searchParams.set("action", "list");
    url.searchParams.set("type", currentType);
    if (PIN) url.searchParams.set("pin", PIN);

    const res = await fetch(url.toString());
    const data = await res.json();

    if (!data.ok) {
      alert("Error listando: " + (data.error || "unknown"));
      return;
    }

    items = data.items || [];
    render();
  }


  function render() {
    listEl.innerHTML = "";
    document.getElementById("countPill").textContent = `${items.length} en lista`;
    emptyEl.textContent = items.length ? "" : "Lista vac√≠a‚Ä¶ a√±ade algo arriba üôÇ";

    for (const it of items) {
      const li = document.createElement("li");
      li.className = "item";

      const span = document.createElement("span");
      span.textContent = it.title;

      const del = document.createElement("button");
      del.className = "del";
      del.textContent = "Eliminar";
      del.onclick = () => deleteItem(it.id);

      li.appendChild(span);
      li.appendChild(del);
      listEl.appendChild(li);
    }
  }


  async function addItem() {
  const title = inputEl.value.trim().replace(/\s+/g, " ");
  if (!title) return;

  try {
    const url = new URL(API_URL);
    url.searchParams.set("action", "add");
    url.searchParams.set("type", currentType);
    url.searchParams.set("title", title);
    if (PIN) url.searchParams.set("pin", PIN);

    const res = await fetch(url.toString());
    const data = await res.json();

    if (!data.ok) {
      alert("Error a√±adiendo: " + (data.error || "unknown"));
      return;
    }

    inputEl.value = "";
    await refresh();
  } catch (err) {
    alert("Fallo de red (add). Mira consola. " + err);
  }
}


async function deleteItem(id) {
  try {
    const url = new URL(API_URL);
    url.searchParams.set("action", "delete");
    url.searchParams.set("id", id);
    if (PIN) url.searchParams.set("pin", PIN);

    const res = await fetch(url.toString());
    const data = await res.json();

    if (!data.ok) {
      alert("Error borrando: " + (data.error || "unknown"));
      return;
    }

    await refresh();
  } catch (err) {
    alert("Fallo de red (delete). Mira consola. " + err);
  }
}



  function chooseRandom(excludingId=null) {
    if (!items.length) return null;
    const pool = excludingId ? items.filter(x => x.id !== excludingId) : items.slice();
    if (!pool.length) return items.find(x => x.id === excludingId) || null;
    return pool[Math.floor(Math.random() * pool.length)];
  }

  function showPick(it) {
    currentPick = it;
    pickedEl.textContent = it.title;
    pickCard.classList.remove("hidden");
  }

  function pickRandom() {
    const it = chooseRandom();
    if (!it) return alert("No hay nada en la lista üôÇ");
    showPick(it);
  }

  function pickAnother() {
    if (!currentPick) return pickRandom();
    const it = chooseRandom(currentPick.id);
    if (it) showPick(it);
  }

  async function markDone() {
    if (!currentPick) return;
    await deleteItem(currentPick.id);
    currentPick = null;
    pickCard.classList.add("hidden");
  }


  inputEl.addEventListener("keydown", (e) => {
    if (e.key === "Enter") addItem();
  });
</script>
</body>
</html>
